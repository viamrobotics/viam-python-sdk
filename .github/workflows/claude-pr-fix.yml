name: Claude PR Fix

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]

jobs:
  pr-fix:
    if: >-
      github.repository_owner == 'viamrobotics' &&
      github.event.issue.pull_request &&
      contains(github.event.comment.body, '@claude-fix')
    # viamrobotics/claude-ci-workflows@v1.9.0
    uses: viamrobotics/claude-ci-workflows/.github/workflows/claude-pr-fix.yml@41c2182579d9039d9fd30b2a2a0976008b402b8b
    with:
      install_command: 'pip install uv && make install'
      allowed_tools: 'Edit,Read,Write,Glob,Grep,Bash(uv run make format*),Bash(uv run make lint*),Bash(uv run make typecheck*),Bash(uv run make test*),Bash(uv run pytest*),Bash(uv run python -m pytest*),Bash(git config *),Bash(git add *),Bash(git commit *),Bash(git push *),Bash(git status*),Bash(git diff*),Bash(git -C * diff*),Bash(git log*),Bash(git checkout *),Bash(git branch *),Bash(git rev-parse *),Bash(git fetch *)'
      extra_prompt: |
        - Run `uv run make format` to format code before committing.
        - Run `uv run make lint` to check for lint issues. Fix any errors.
      extra_system_prompt: >-
        Only run make buf to regenerate src/viam/gen/. Do NOT run other make targets unless explicitly needed.
    secrets:
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
      GIT_ACCESS_TOKEN: ${{ secrets.GIT_ACCESS_TOKEN }}
