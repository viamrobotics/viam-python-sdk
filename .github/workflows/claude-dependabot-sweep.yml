name: Claude Dependabot Sweep

on:
  schedule:
    - cron: '0 14 * * 2' # Every Tuesday at 9 AM EST
  workflow_dispatch:

jobs:
  sweep:
    # viamrobotics/claude-ci-workflows@v1.10.5
    uses: viamrobotics/claude-ci-workflows/.github/workflows/claude-dependabot-sweep.yml@8b2aba7850de00d5b63daf3ff1a7c8347f483830
    with:
      install_command: 'pip install uv && make install'
      allowed_tools: 'Edit,Read,Write,Glob,Grep,Bash(uv add*),Bash(uv lock*),Bash(uv sync*),Bash(uv run make format*),Bash(uv run make lint*),Bash(uv pip *),Bash(curl -s https://pypi.org/pypi/*),Bash(pip install uv*),Bash(make install*),Bash(git config *),Bash(git add *),Bash(git commit *),Bash(git push *),Bash(git status*),Bash(git diff*),Bash(git log*),Bash(git checkout *),Bash(git branch *),Bash(git rev-parse *),Bash(git fetch *),Bash(gh pr create*),Bash(gh pr list*)'
      alert_severity: 'critical,high,medium'
      max_turns: 40
      extra_prompt: |
        - This project uses `uv` for dependency management with `pyproject.toml` and `uv.lock`.
        - To update a dependency: edit the version constraint in `pyproject.toml`, then run `uv lock` to regenerate the lockfile.
          Alternatively, use `uv add <package>>=<version>` to update both `pyproject.toml` and `uv.lock` in one step.
        - For package investigation, use ONLY these Bash commands: uv pip show, uv pip index versions, uv add, uv lock.
        - Do NOT use: python3, pip (without uv prefix), curl, WebFetch, WebSearch, or uv run python3. These are not available."
        - Do NOT edit `uv.lock` directly â€” always regenerate it with `uv lock`.
        - Run `uv run make format` to format code before committing.
        - Run `uv run make lint` to check for lint issues. Fix any errors.
      extra_system_prompt: >-
        Only run make buf to regenerate src/viam/gen/. Do NOT run other make targets unless explicitly needed.
    secrets:
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
      CI_GITHUB_APP_ID: ${{ secrets.CI_GITHUB_APP_ID }}
      CI_GITHUB_APP_PRIVATE_KEY: ${{ secrets.CI_GITHUB_APP_PRIVATE_KEY }}
      SLACK_AI_WORKFLOW_ALERT_WEBHOOK_URL: ${{ secrets.SLACK_AI_WORKFLOW_ALERT_WEBHOOK_URL }}
