<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Example usage &mdash; Viam Python SDK  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="../changelog.html" />
    <link rel="prev" title="Viam Python SDK" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Viam Python SDK
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#connect-as-a-client">Connect as a client</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-custom-modules">Create custom modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#subclass-a-resource">1. Subclass a resource</a></li>
<li class="toctree-l3"><a class="reference internal" href="#register-the-new-modular-resource">2. Register the new modular resource</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#optional-validator-and-reconfiguration-functions">Optional Validator and Reconfiguration Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#start-the-module">3. Start the module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#make-the-module-executable">4. Make the module executable</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-a-modular-resource">5. Configure a modular resource</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-modular-arm-example">Custom Modular Arm Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#create-custom-remotes">Create custom remotes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#subclass-a-component">1. Subclass a component</a></li>
<li class="toctree-l3"><a class="reference internal" href="#register-the-custom-component">2. Register the custom component</a></li>
<li class="toctree-l3"><a class="reference internal" href="#start-the-server-and-add-it-as-a-remote">3. Start the Server and add it as a Remote</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#convert-a-custom-remote-to-a-custom-module">Convert a custom remote to a custom module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connect-as-a-client-to-app">Connect as a client to app</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.viam.com">Full Viam Docs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/viam/components/index.html">viam.components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/viam/services/index.html">viam.services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/viam/robot/index.html">viam.robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/viam/app/index.html">viam.app</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/viam/resource/index.html">viam.resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/viam/module/index.html">viam.module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/viam/media/index.html">viam.media</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/viam/rpc/index.html">viam.rpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/viam/proto/index.html">viam.proto</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Viam Python SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Example usage</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/example.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="example-usage">
<h1>Example usage<a class="headerlink" href="#example-usage" title="Permalink to this heading"></a></h1>
<p>The Viam SDK can be used in three ways:</p>
<ol class="arabic simple">
<li><p>As a client to connect to a (remote or local) robot</p></li>
<li><p>Integrate custom resources to a robot</p></li>
<li><p>As a client to connect to app.viam.com to upload and retrieve data</p></li>
</ol>
<section id="connect-as-a-client">
<h2>Connect as a client<a class="headerlink" href="#connect-as-a-client" title="Permalink to this heading"></a></h2>
<p>To connect to a robot as a client, you should instantiate an instance of a <code class="docutils literal notranslate"><span class="pre">RobotClient</span></code></p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">viam</span> <span class="kn">import</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">viam.robot.client</span> <span class="kn">import</span> <span class="n">RobotClient</span>
<span class="kn">from</span> <span class="nn">viam.rpc.dial</span> <span class="kn">import</span> <span class="n">DialOptions</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">connect</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">RobotClient</span><span class="p">:</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">RobotClient</span><span class="o">.</span><span class="n">Options</span><span class="p">(</span><span class="n">dial_options</span><span class="o">=</span><span class="n">DialOptions</span><span class="p">(</span><span class="n">insecure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">disable_webrtc</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">FATAL</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">RobotClient</span><span class="o">.</span><span class="n">at_address</span><span class="p">(</span><span class="s2">&quot;localhost:9091&quot;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You can also create a <code class="docutils literal notranslate"><span class="pre">RobotClient</span></code> by providing an existing connection</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">viam</span> <span class="kn">import</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">viam.robot.client</span> <span class="kn">import</span> <span class="n">RobotClient</span>
<span class="kn">from</span> <span class="nn">viam.rpc.dial</span> <span class="kn">import</span> <span class="n">DialOptions</span><span class="p">,</span> <span class="n">dial</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">connect_with_channel</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">RobotClient</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">with</span> <span class="k">await</span> <span class="n">dial</span><span class="p">(</span><span class="s2">&quot;localhost:9091&quot;</span><span class="p">,</span> <span class="n">DialOptions</span><span class="p">(</span><span class="n">insecure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">disable_webrtc</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="k">as</span> <span class="n">channel</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">RobotClient</span><span class="o">.</span><span class="n">with_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">RobotClient</span><span class="o">.</span><span class="n">Options</span><span class="p">(</span><span class="n">refresh_interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">FATAL</span><span class="p">))</span>


<span class="k">async</span> <span class="k">with</span> <span class="k">await</span> <span class="n">connect_with_channel</span><span class="p">()</span> <span class="k">as</span> <span class="n">robot</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">resource_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;viam.proto.common.ResourceName rdk:component:gripper/gripper0 at 0x7f408c3aea70&gt;, &lt;viam.proto.common.ResourceName rdk:component:audio_out/audio_out0 at 0x7f408c3ad530&gt;, &lt;viam.proto.common.ResourceName rdk:component:servo/servo0 at 0x7f408c3aeb60&gt;, &lt;viam.proto.common.ResourceName rdk:component:board/board at 0x7f408c3aeb10&gt;, &lt;viam.proto.common.ResourceName rdk:component:motor/motor0 at 0x7f408c3aebb0&gt;, &lt;viam.proto.common.ResourceName rdk:component:arm/arm0 at 0x7f408c3aec00&gt;, &lt;viam.proto.common.ResourceName rdk:component:camera/camera0 at 0x7f408c3aec50&gt;, &lt;viam.proto.common.ResourceName rdk:component:encoder/encoder0 at 0x7f408c3aeca0&gt;, &lt;viam.proto.common.ResourceName rdk:component:audio_in/audio_in0 at 0x7f408c3aecf0&gt;, &lt;viam.proto.common.ResourceName rdk:service:mlmodel/mlmodel0 at 0x7f408c3aed40&gt;, &lt;viam.proto.common.ResourceName rdk:component:movement_sensor/movement_sensor0 at 0x7f408c3aed90&gt;, &lt;viam.proto.common.ResourceName rdk:component:sensor/sensor0 at 0x7f408c3aede0&gt;, &lt;viam.proto.common.ResourceName rdk:component:audio_input/audio_input0 at 0x7f408c3aee30&gt;, &lt;viam.proto.common.ResourceName rdk:service:slam/slam0 at 0x7f408c3aee80&gt;, &lt;viam.proto.common.ResourceName rdk:component:pose_tracker/pose_tracker0 at 0x7f408c3aeed0&gt;, &lt;viam.proto.common.ResourceName rdk:component:gantry/gantry0 at 0x7f408c3aef20&gt;, &lt;viam.proto.common.ResourceName rdk:component:base/base0 at 0x7f408c3aef70&gt;]
</pre></div>
</div>
</div>
</details>
</div>
<p>Once you have a connected <code class="docutils literal notranslate"><span class="pre">RobotClient</span></code>, you can then obtain the robot’s components by their name</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">viam.components.camera</span> <span class="kn">import</span> <span class="n">Camera</span>
<span class="kn">from</span> <span class="nn">viam.media.video</span> <span class="kn">import</span> <span class="n">CameraMimeType</span>
<span class="kn">from</span> <span class="nn">viam.media.utils.pil</span> <span class="kn">import</span> <span class="n">viam_to_pil_image</span>

<span class="k">async</span> <span class="k">with</span> <span class="k">await</span> <span class="n">connect_with_channel</span><span class="p">()</span> <span class="k">as</span> <span class="n">robot</span><span class="p">:</span>
    <span class="n">camera</span> <span class="o">=</span> <span class="n">Camera</span><span class="o">.</span><span class="n">from_robot</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="s2">&quot;camera0&quot;</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="k">await</span> <span class="n">camera</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">CameraMimeType</span><span class="o">.</span><span class="n">JPEG</span><span class="p">)</span>
    <span class="n">pil</span> <span class="o">=</span> <span class="n">viam_to_pil_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">pil</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;foo.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output tag_remove-input docutils container">
<details class="hide above-output">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell outputs</span>
<span class="expanded">Hide code cell outputs</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;viam.media.video.ViamImage at 0x7f407c9e5040&gt;
</pre></div>
</div>
</div>
</details>
</div>
<p>You can also use the <code class="docutils literal notranslate"><span class="pre">RobotClient</span></code> to make service calls to the connected robot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">viam.services.vision</span> <span class="kn">import</span> <span class="n">VisionClient</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">vision</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="k">await</span> <span class="n">connect_with_channel</span><span class="p">()</span> <span class="k">as</span> <span class="n">robot</span><span class="p">:</span>
        <span class="n">vision</span> <span class="o">=</span> <span class="n">VisionClient</span><span class="o">.</span><span class="n">from_robot</span><span class="p">(</span><span class="n">robot</span><span class="p">)</span>
        <span class="n">detections</span> <span class="o">=</span> <span class="k">await</span> <span class="n">vision</span><span class="o">.</span><span class="n">get_detections_from_camera</span><span class="p">(</span><span class="s2">&quot;camera_1&quot;</span><span class="p">,</span> <span class="s2">&quot;detector_1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-custom-modules">
<h2>Create custom modules<a class="headerlink" href="#create-custom-modules" title="Permalink to this heading"></a></h2>
<p>Make a modular resource from an existing resource API. In this document, we will be going over subclassing existing resource APIs. To learn more about creating a new resource API, see the <a class="reference external" href="https://docs.viam.com/extend/modular-resources/#code-your-module">Viam docs</a>, and <a class="reference external" href="https://github.com/viamrobotics/viam-python-sdk/tree/main/examples/complex_module">complex module example</a>.</p>
<p>For a fully fleshed-out example of a Python module that uses Github CI to upload to the Viam Registry, take a look at <a class="reference external" href="https://github.com/viam-labs/python-example-module">python-example-module</a>. For an example that uses Docker to manage dependencies, take a look at <a class="reference external" href="https://github.com/viamrobotics/python-container-module">python-container-module</a>. For a list of example modules in different Viam SDKs, take a look <a class="reference external" href="https://github.com/viamrobotics/upload-module/#example-repos">here</a>.</p>
<p>The code below resembles the <a class="reference external" href="https://github.com/viamrobotics/viam-python-sdk/tree/main/examples/simple_module">simple module example</a>, so look there for the final, completed modular resource.</p>
<p>The steps required in creating a modular resource and connecting it to a robot are:</p>
<ol class="arabic simple">
<li><p><strong>Subclass a resource and implement desired functions.</strong> This will be your custom resource model.</p>
<ul class="simple">
<li><p>For functions that you do not wish to implement, you must at least define them by putting <code class="docutils literal notranslate"><span class="pre">pass</span></code> or <code class="docutils literal notranslate"><span class="pre">raise</span> <span class="pre">NotImplementedError()</span></code> in the function.</p></li>
</ul>
</li>
<li><p><strong>Register a new model.</strong> This will register the new modular resource model into the <code class="docutils literal notranslate"><span class="pre">Registry</span></code>.</p></li>
<li><p><strong>Start the module.</strong> Create and start the new module.</p></li>
<li><p><strong>Make the module executable.</strong> This allows <code class="docutils literal notranslate"><span class="pre">viam-server</span></code> to access and execute the module.</p></li>
<li><p><strong>Configure a modular resource.</strong> Use the new module and instantiate a new resource to a robot!</p></li>
</ol>
<p>Knowing this, let’s implement a custom resource.</p>
<section id="subclass-a-resource">
<h3>1. Subclass a resource<a class="headerlink" href="#subclass-a-resource" title="Permalink to this heading"></a></h3>
<p>The SDK provides a wide array of resource APIs to customize. You can browse through the API Reference to see the available resources. Subclass a resource and implement the required functions. You may leave the other methods unimplemented by putting <code class="docutils literal notranslate"><span class="pre">pass</span></code> or <code class="docutils literal notranslate"><span class="pre">raise</span> <span class="pre">NotImplementedError()</span></code> in the function.</p>
<p>This example uses a <code class="docutils literal notranslate"><span class="pre">Sensor</span></code> as an example.</p>
<p>Create a sensor that returns the Wi-Fi signal of a Pi. Start by creating a directory on the Pi named <code class="docutils literal notranslate"><span class="pre">wifi-sensor</span></code>, then create a directory inside the <code class="docutils literal notranslate"><span class="pre">wifi-sensor</span></code> directory named <code class="docutils literal notranslate"><span class="pre">src</span></code>. Then, inside the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory, create a new file named <code class="docutils literal notranslate"><span class="pre">wifi_sensor_module.py</span></code>.
Copy the code below into your <code class="docutils literal notranslate"><span class="pre">wifi_sensor_module.py</span></code> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># wifi-sensor/src/wifi_sensor_module.py</span>
<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">viam.components.sensor</span> <span class="kn">import</span> <span class="n">Sensor</span>
<span class="kn">from</span> <span class="nn">viam.utils</span> <span class="kn">import</span> <span class="n">SensorReading</span>


<span class="k">class</span> <span class="nc">MySensor</span><span class="p">(</span><span class="n">Sensor</span><span class="p">):</span>
    <span class="c1"># Subclass the Viam Sensor component and implement the required functions</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_readings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SensorReading</span><span class="p">]:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/proc/net/wireless&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">wifi_stats</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">wifi_stats</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">wifi_signal</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">content</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="n">wifi_signal</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">wifi_signal</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;noise&quot;</span><span class="p">:</span> <span class="n">wifi_signal</span><span class="p">[</span><span class="mi">4</span><span class="p">]}</span>
    
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_geometries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Geometry</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This is a completely optional function to include. This will be called when the resource is removed from the config or the module</span>
        <span class="c1"># is shutting down.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is closed.&quot;</span><span class="p">)</span>

<span class="c1"># Anything below this line is optional and will be replaced later, but may come in handy for debugging and testing.</span>
<span class="c1"># To use, call `python wifi_sensor_module.py` in the command line while in the `src` directory.</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">wifi</span><span class="o">=</span><span class="n">MySensor</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;wifi&quot;</span><span class="p">)</span>
    <span class="n">signal</span> <span class="o">=</span> <span class="k">await</span> <span class="n">wifi</span><span class="o">.</span><span class="n">get_readings</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>You can view more component implementations in the <a class="reference external" href="https://github.com/viamrobotics/python-sdk/blob/main/examples/server/v1/components.py">examples</a>.</p>
</section>
<section id="register-the-new-modular-resource">
<h3>2. Register the new modular resource<a class="headerlink" href="#register-the-new-modular-resource" title="Permalink to this heading"></a></h3>
<p>Now that we’ve created the modular resource model, we must register it to the registry.</p>
<p>Define a <a class="reference external" href="https://docs.viam.com/appendix/glossary/#term-model"><code class="docutils literal notranslate"><span class="pre">Model</span></code></a> name and a creator function in the resource. A creator function is a function that can create a resource given a config and map of dependencies.</p>
<p>To define a creator function and <code class="docutils literal notranslate"><span class="pre">Model</span></code> in <code class="docutils literal notranslate"><span class="pre">wifi_sensor_module.py</span></code>, import <code class="docutils literal notranslate"><span class="pre">ComponentConfig</span></code>, <code class="docutils literal notranslate"><span class="pre">ResourceName</span></code>, <code class="docutils literal notranslate"><span class="pre">ResourceBase</span></code>, <code class="docutils literal notranslate"><span class="pre">Model</span></code>, and <code class="docutils literal notranslate"><span class="pre">ModelFamily</span></code> from the relative viam packages. Please note that the import packages also have to be changed to include <code class="docutils literal notranslate"><span class="pre">Mapping</span></code> and <code class="docutils literal notranslate"><span class="pre">ClassVar</span></code> from <code class="docutils literal notranslate"><span class="pre">typing</span></code> and <code class="docutils literal notranslate"><span class="pre">Self</span></code> from <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code>. The changes can be seen in the example below.</p>
<p>In your <code class="docutils literal notranslate"><span class="pre">wifi_sensor_module.py</span></code>, define a new <code class="docutils literal notranslate"><span class="pre">MODEL</span></code> variable in your <code class="docutils literal notranslate"><span class="pre">MySensor</span></code> class, shown below. Then add a <code class="docutils literal notranslate"><span class="pre">new()</span></code> function that will act as our creator function. We get the name from the config and return the resource. We can also assign class variables based on what the config has.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># wifi-sensor/src/wifi_sensor_module.py</span>
<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">ClassVar</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Self</span>

<span class="kn">from</span> <span class="nn">viam.proto.app.robot</span> <span class="kn">import</span> <span class="n">ComponentConfig</span>
<span class="kn">from</span> <span class="nn">viam.proto.common</span> <span class="kn">import</span> <span class="n">ResourceName</span>
<span class="kn">from</span> <span class="nn">viam.resource.base</span> <span class="kn">import</span> <span class="n">ResourceBase</span>
<span class="kn">from</span> <span class="nn">viam.resource.types</span> <span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">ModelFamily</span>

<span class="k">class</span> <span class="nc">MySensor</span><span class="p">(</span><span class="n">Sensor</span><span class="p">):</span>
    <span class="c1"># Subclass the Viam Sensor component and implement the required functions</span>
    <span class="n">MODEL</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Model</span><span class="p">]</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">ModelFamily</span><span class="p">(</span><span class="s2">&quot;viam&quot;</span><span class="p">,</span><span class="s2">&quot;sensor&quot;</span><span class="p">),</span> <span class="s2">&quot;linux-wifi&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ComponentConfig</span><span class="p">,</span> <span class="n">dependencies</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">ResourceName</span><span class="p">,</span> <span class="n">ResourceBase</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="n">sensor</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sensor</span>
</pre></div>
</div>
<p>After the resource model has a defined model and creator function, the resource model must be registered to the <code class="docutils literal notranslate"><span class="pre">Registry</span></code>. This can be done using <a class="reference external" href="https://python.viam.dev/autoapi/viam/resource/registry/index.html#viam.resource.registry.Registry.register_resource_creator"><code class="docutils literal notranslate"><span class="pre">register_resource_creator()</span></code></a> and passing a <a class="reference external" href="https://python.viam.dev/autoapi/viam/resource/registry/index.html#viam.resource.registry.ResourceCreatorRegistration"><code class="docutils literal notranslate"><span class="pre">ResourceCreatorRegistration</span></code></a> object with the creator function as a parameter.</p>
<p>In the main function of <code class="docutils literal notranslate"><span class="pre">wifi_sensor_module.py</span></code>, call <code class="docutils literal notranslate"><span class="pre">Registry.register_resource_creator()</span></code> with the subtype of the resource that was subclassed, the model name, and a <code class="docutils literal notranslate"><span class="pre">ResourceCreatorRegistration</span></code> object with the creator function defined in the modular resource. In a more complex module, it makes sense to call the function in an <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file in the same folder as the new resource model. See <a class="reference external" href="https://github.com/viamrobotics/viam-python-sdk/tree/main/examples/complex_module/src/arm/__init__.py">here</a> for an example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># wifi-sensor/src/wifi_sensor_module.py</span>
<span class="kn">from</span> <span class="nn">viam.resource.registry</span> <span class="kn">import</span> <span class="n">Registry</span><span class="p">,</span> <span class="n">ResourceCreatorRegistration</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">Registry</span><span class="o">.</span><span class="n">register_resource_creator</span><span class="p">(</span><span class="n">Sensor</span><span class="o">.</span><span class="n">SUBTYPE</span><span class="p">,</span> <span class="n">MySensor</span><span class="o">.</span><span class="n">MODEL</span><span class="p">,</span> <span class="n">ResourceCreatorRegistration</span><span class="p">(</span><span class="n">MySensor</span><span class="o">.</span><span class="n">new</span><span class="p">))</span>
</pre></div>
</div>
<p>Click <a class="reference external" href="https://github.com/viamrobotics/viam-python-sdk/blob/main/docs/examples/module_step2.py">here</a> to see the file with its new <code class="docutils literal notranslate"><span class="pre">MODEL</span></code> variable, creator function, and <code class="docutils literal notranslate"><span class="pre">main()</span></code> function.</p>
<section id="optional-validator-and-reconfiguration-functions">
<h4>Optional Validator and Reconfiguration Functions<a class="headerlink" href="#optional-validator-and-reconfiguration-functions" title="Permalink to this heading"></a></h4>
<p>Modules also have support for validator and reconfiguration functions.</p>
<p>Custom validation can be done by specifying a validate function. Validate functions can raise errors that will be returned to the parent through gRPC. Validate functions return two sequences of strings: the first represents the implicit required dependencies and the second represents the optional dependencies. If there are none for either, return an empty sequence <code class="docutils literal notranslate"><span class="pre">[]</span></code> (if there are no required dependencies and no optional dependencies, return <code class="docutils literal notranslate"><span class="pre">[],</span> <span class="pre">[]</span></code>) .</p>
<p>For example, let’s say <code class="docutils literal notranslate"><span class="pre">MySensor</span></code> had a <code class="docutils literal notranslate"><span class="pre">multiplier</span></code> argument that is used to multiply the returned readings in <code class="docutils literal notranslate"><span class="pre">get_readings()</span></code>. The validation function can check if a multiplier attribute was provided and prevent erroneous resource start ups.</p>
<p>Reconfiguration specifies what values can change based on a new configuration. To allow this, add a <code class="docutils literal notranslate"><span class="pre">reconfigure()</span></code> function to the <code class="docutils literal notranslate"><span class="pre">MySensor</span></code> class. A good pattern is to call <code class="docutils literal notranslate"><span class="pre">reconfigure()</span></code> within <code class="docutils literal notranslate"><span class="pre">new()</span></code>, since initialization and reconfiguration are usually very similar.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ADD `Sequence` and `Tuple` FROM `typing`.</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">from</span> <span class="nn">viam.utils</span> <span class="kn">import</span> <span class="n">SensorReading</span>

<span class="k">class</span> <span class="nc">MySensor</span><span class="p">(</span><span class="n">Sensor</span><span class="p">):</span>
    <span class="c1"># ADD A VALIDATOR FUNCTION </span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ComponentConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="s2">&quot;multiplier&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;multiplier&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s2">&quot;number_value&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Multiplier must be a float.&quot;</span><span class="p">)</span>
            <span class="n">multiplier</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;multiplier&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">number_value</span>
            <span class="k">if</span> <span class="n">multiplier</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Multiplier cannot be 0.&quot;</span><span class="p">)</span>
        <span class="c1"># RETURN EMPTY SEQUENCES (no required or optional dependencies necessary)</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ComponentConfig</span><span class="p">,</span> <span class="n">dependencies</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">ResourceName</span><span class="p">,</span> <span class="n">ResourceBase</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="n">sensor</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># CALL RECONFIGURE TO INITIALIZE THE RESOURCE</span>
        <span class="n">sensor</span><span class="o">.</span><span class="n">reconfigure</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">dependencies</span><span class="p">)</span>        
        <span class="k">return</span> <span class="n">sensor</span>

    <span class="k">def</span> <span class="nf">reconfigure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ComponentConfig</span><span class="p">,</span> <span class="n">dependencies</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">ResourceName</span><span class="p">,</span> <span class="n">ResourceBase</span><span class="p">]):</span>
        <span class="k">if</span> <span class="s2">&quot;multiplier&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">multiplier</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;multiplier&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">number_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">multiplier</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplier</span> <span class="o">=</span> <span class="n">multiplier</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_readings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SensorReading</span><span class="p">]:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/proc/net/wireless&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">wifi_stats</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">wifi_stats</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">content</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
        
        <span class="c1"># MULTIPLY THE READINGS WITH MULTIPLIER</span>
        <span class="n">wifi_signal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">wifi_signal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplier</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="n">wifi_signal</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">wifi_signal</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;noise&quot;</span><span class="p">:</span> <span class="n">wifi_signal</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
</pre></div>
</div>
<p>If a validator function is added, it must also be called when registering the resource. The <code class="docutils literal notranslate"><span class="pre">ResourceCreatorRegistration</span></code> should now also have the validator function passed in as the second parameter.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
            <span class="n">Registry</span><span class="o">.</span><span class="n">register_resource_creator</span><span class="p">(</span><span class="n">Sensor</span><span class="o">.</span><span class="n">SUBTYPE</span><span class="p">,</span> <span class="n">MySensor</span><span class="o">.</span><span class="n">MODEL</span><span class="p">,</span> <span class="n">ResourceCreatorRegistration</span><span class="p">(</span><span class="n">MySensor</span><span class="o">.</span><span class="n">new</span><span class="p">,</span> <span class="n">MySensor</span><span class="o">.</span><span class="n">validate_config</span><span class="p">))</span>
</pre></div>
</div>
<p>Click <a class="reference external" href="https://github.com/viamrobotics/viam-python-sdk/blob/main/docs/examples/module_step2_optional.py">here</a> to see the new <code class="docutils literal notranslate"><span class="pre">wifi_sensor_module.py</span></code> with the optional validator and reconfiguration functions.</p>
</section>
</section>
<section id="start-the-module">
<h3>3. Start the module<a class="headerlink" href="#start-the-module" title="Permalink to this heading"></a></h3>
<p>The module now has to be created and started. In the <code class="docutils literal notranslate"><span class="pre">wifi_sensor_module.py</span></code> file, update the main function to the following. If there is a validator function in the class, don’t forget to add the function to the <code class="docutils literal notranslate"><span class="pre">ResourceCreatorRegistration</span></code> object. In a more complex module, it makes sense to create an entirely new entrypoint file. See <a class="reference external" href="https://github.com/viamrobotics/viam-python-sdk/tree/main/examples/complex_module/src/main.py">here</a> for an example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># wifi-sensor/src/wifi_sensor_module.py</span>
<span class="kn">from</span> <span class="nn">viam.module.module</span> <span class="kn">import</span> <span class="n">Module</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function creates and starts a new module, after adding all desired resource model.</span>
<span class="sd">    Resource creators must be registered to the resource registry before the module adds the resource model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Registry</span><span class="o">.</span><span class="n">register_resource_creator</span><span class="p">(</span><span class="n">Sensor</span><span class="o">.</span><span class="n">SUBTYPE</span><span class="p">,</span> <span class="n">MySensor</span><span class="o">.</span><span class="n">MODEL</span><span class="p">,</span> <span class="n">ResourceCreatorRegistration</span><span class="p">(</span><span class="n">MySensor</span><span class="o">.</span><span class="n">new</span><span class="p">))</span>

    <span class="n">module</span> <span class="o">=</span> <span class="n">Module</span><span class="o">.</span><span class="n">from_args</span><span class="p">()</span>
    <span class="n">module</span><span class="o">.</span><span class="n">add_model_from_registry</span><span class="p">(</span><span class="n">Sensor</span><span class="o">.</span><span class="n">SUBTYPE</span><span class="p">,</span> <span class="n">MySensor</span><span class="o">.</span><span class="n">MODEL</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">module</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>To see <code class="docutils literal notranslate"><span class="pre">wifi_sensor_module.py</span></code> with all of the changes, click <a class="reference external" href="https://github.com/viamrobotics/viam-python-sdk/blob/main/docs/examples/module_step3.py">here</a>.</p>
</section>
<section id="make-the-module-executable">
<h3>4. Make the module executable<a class="headerlink" href="#make-the-module-executable" title="Permalink to this heading"></a></h3>
<p>To add the module to your robot, you must provide it as an <a class="reference external" href="https://docs.viam.com/extend/modular-resources/#make-your-module-executable">executable file</a> that <a class="reference external" href="https://docs.viam.com/extend/modular-resources/#make-sure-viam-server-can-access-your-executable"><code class="docutils literal notranslate"><span class="pre">viam-server</span></code> can access</a>.</p>
<p>Dependencies for the module (including Viam SDK) have to be installed. In the <code class="docutils literal notranslate"><span class="pre">wifi-sensor</span></code> directory, create a new file called <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> that has all your dependencies. For this example, add <code class="docutils literal notranslate"><span class="pre">viam-sdk</span></code> in <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># add a version if viam should be pinned to a specific version</span>
<span class="n">viam</span><span class="o">-</span><span class="n">sdk</span>
</pre></div>
</div>
<p>One option with the Python SDK is to create a new shell script (<code class="docutils literal notranslate"><span class="pre">.sh</span></code>) that runs your module, which can also be used to install the dependencies. For example, in the <code class="docutils literal notranslate"><span class="pre">wifi-sensor</span></code> directory, add an <code class="docutils literal notranslate"><span class="pre">run.sh</span></code> file:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nb">cd</span><span class="w"> </span><span class="sb">`</span>dirname<span class="w"> </span><span class="nv">$0</span><span class="sb">`</span>

<span class="c1"># Create a virtual environment to run our code</span>
<span class="nv">VENV_NAME</span><span class="o">=</span><span class="s2">&quot;venv&quot;</span>
<span class="nv">PYTHON</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$VENV_NAME</span><span class="s2">/bin/python&quot;</span>
<span class="nv">ENV_ERROR</span><span class="o">=</span><span class="s2">&quot;This module requires Python &gt;=3.8, pip, and virtualenv to be installed.&quot;</span>

<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span><span class="nv">$VENV_NAME</span><span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Failed to create virtualenv.&quot;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>apt-get<span class="w"> </span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Detected Debian/Ubuntu, attempting to install python3-venv automatically.&quot;</span>
<span class="w">        </span><span class="nv">SUDO</span><span class="o">=</span><span class="s2">&quot;sudo&quot;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span><span class="nv">$SUDO</span><span class="w"> </span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nv">SUDO</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>apt<span class="w"> </span>info<span class="w"> </span>python3-venv<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">			</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Package info not found, trying apt update&quot;</span>
<span class="w">			</span><span class="nv">$SUDO</span><span class="w"> </span>apt<span class="w"> </span>-qq<span class="w"> </span>update<span class="w"> </span>&gt;/dev/null
<span class="w">		</span><span class="k">fi</span>
<span class="w">        </span><span class="nv">$SUDO</span><span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-qqy<span class="w"> </span>python3-venv<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span><span class="nv">$VENV_NAME</span><span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$ENV_ERROR</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">            </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$ENV_ERROR</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="k">fi</span>

<span class="c1"># remove -U if viam-sdk should not be upgraded whenever possible</span>
<span class="c1"># -qq suppresses extraneous output from pip</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Virtualenv found/created. Installing/upgrading Python packages...&quot;</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nv">$PYTHON</span><span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt<span class="w"> </span>-Uqq<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># Be sure to use `exec` so that termination signals reach the python process,</span>
<span class="c1"># or handle forwarding termination signals manually</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Starting module...&quot;</span>
<span class="nb">exec</span><span class="w"> </span><span class="nv">$PYTHON</span><span class="w"> </span>src/wifi-sensor.py<span class="w"> </span><span class="nv">$@</span>
</pre></div>
</div>
<p><strong>Please note that a more complex module should be run as a Python module, meaning that the file extension <code class="docutils literal notranslate"><span class="pre">.py</span></code> has to be omitted. See <a class="reference external" href="https://github.com/viamrobotics/viam-python-sdk/tree/main/examples/complex_module/run.sh">here</a> for an example.</strong></p>
<p>To make this shell script executable, run this in the Terminal:</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chmod</span> <span class="pre">+x</span> <span class="pre">&lt;FILEPATH&gt;/&lt;FILENAME&gt;</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;FILENAME&gt;</span></code> would be <code class="docutils literal notranslate"><span class="pre">run.sh</span></code>.</p>
</section>
<section id="configure-a-modular-resource">
<h3>5. Configure a modular resource<a class="headerlink" href="#configure-a-modular-resource" title="Permalink to this heading"></a></h3>
<p><strong>NOTE:</strong> <em>If you are adding your module to the registry, follow <a class="reference external" href="https://docs.viam.com/extend/modular-resources/configure/">these instructions</a> instead. Otherwise, continue with these instructions, which will show you how to configure the module locally.</em></p>
<p><a class="reference external" href="https://docs.viam.com/extend/modular-resources/#configure-your-module">Configure your new module</a> on your robot by navigating to the <strong>Config</strong> tab of the machine’s page, then click on the <strong>Modules</strong> subtab. Add the name of your module and the executable path. For our example, the path would be <code class="docutils literal notranslate"><span class="pre">&lt;path-on-your-filesystem&gt;/linux-wifi/run.sh</span></code>.</p>
<p>Once you have configured a module as part of your robot configuration, <a class="reference external" href="https://docs.viam.com/extend/modular-resources/#configure-your-modular-resource">configure your modular resource</a> made available by that module by adding new components or services configured with your modular resources’ new type or model. To instantiate a new resource from your module, specify the <code class="docutils literal notranslate"><span class="pre">type</span></code>, <code class="docutils literal notranslate"><span class="pre">model</span></code>, and <code class="docutils literal notranslate"><span class="pre">name</span></code> of your modular resource. The aforementioned <code class="docutils literal notranslate"><span class="pre">type</span></code>, <code class="docutils literal notranslate"><span class="pre">model</span></code>, and <code class="docutils literal notranslate"><span class="pre">name</span></code> should be the same as those in the <code class="docutils literal notranslate"><span class="pre">MODEL</span></code> class attribute defined in your <a class="reference internal" href="#register-the-custom-component"><span class="xref myst">component class</span></a>. This is a JSON example:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;components&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;viam:sensor:linux-wifi&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">      </span><span class="nt">&quot;depends_on&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-sensor&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sensor&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;modules&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;executable_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;path-on-your-filesystem&gt;/linux-wifi/run.sh&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;wifi_sensor&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note the nomenclature of the above <code class="docutils literal notranslate"><span class="pre">model</span></code> field, <code class="docutils literal notranslate"><span class="pre">viam:sensor:linux-wifi</span></code>. Models are uniquely namespaced as colon-delimited-triplets in the form <code class="docutils literal notranslate"><span class="pre">namespace:family:name</span></code>, and are named according to the Viam API that your model implements. A model with the <code class="docutils literal notranslate"><span class="pre">viam</span></code> namespace is always Viam-provided. Read more about making custom namespaces <a class="reference external" href="https://docs.viam.com/registry/create/#name-your-new-resource-model">here</a>.</p>
<p>Viam also provides many built-in models that implement API capabilities, each using <code class="docutils literal notranslate"><span class="pre">rdk</span></code> as the <code class="docutils literal notranslate"><span class="pre">namespace</span></code>, and <code class="docutils literal notranslate"><span class="pre">builtin</span></code> as the <code class="docutils literal notranslate"><span class="pre">family</span></code>:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">rdk:builtin:gpio</span></code> model of the <code class="docutils literal notranslate"><span class="pre">rdk:component:motor</span></code> API provides RDK support for <a class="reference external" href="https://docs.viam.com/components/motor/gpio/">GPIO-controlled DC motors</a>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">rdk:builtin:DMC4000</span></code> model of the same <code class="docutils literal notranslate"><span class="pre">rdk:component:motor</span></code> API provides RDK support for the <a class="reference external" href="https://docs.viam.com/components/motor/dmc4000/">DMC4000</a> motor.</p></li>
</ul>
</section>
<section id="custom-modular-arm-example">
<h3>Custom Modular Arm Example<a class="headerlink" href="#custom-modular-arm-example" title="Permalink to this heading"></a></h3>
<p>The following is an example of how to implement a custom modular arm. For further instructions, read the detailed <code class="docutils literal notranslate"><span class="pre">Sensor</span></code> example above. Our custom Arm will be extremely simple. Please note that the minimum set of endpoints you need to implement for an arm are <code class="docutils literal notranslate"><span class="pre">GetKinematics</span></code>, <code class="docutils literal notranslate"><span class="pre">GetJointPositions</span></code>, and <code class="docutils literal notranslate"><span class="pre">MoveToJointPositions</span></code>.</p>
<p>This arm example contains a minimal kinematics model. For a full model, take a look <a class="reference external" href="https://github.com/viamrobotics/viam-python-sdk/blob/main/examples/complex_module/src/arm/my_arm_kinematics.json">here</a>.</p>
<p>Subclassing the <code class="docutils literal notranslate"><span class="pre">Arm</span></code> component and implementing the required functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># modular-arm/src/my_modular_arm.py</span>
<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">ClassVar</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Self</span>

<span class="kn">from</span> <span class="nn">viam.components.arm</span> <span class="kn">import</span> <span class="n">Arm</span><span class="p">,</span> <span class="n">JointPositions</span><span class="p">,</span> <span class="n">KinematicsFileFormat</span><span class="p">,</span> <span class="n">Pose</span>
<span class="kn">from</span> <span class="nn">viam.module.module</span> <span class="kn">import</span> <span class="n">Module</span>
<span class="kn">from</span> <span class="nn">viam.operations</span> <span class="kn">import</span> <span class="n">run_with_operation</span>
<span class="kn">from</span> <span class="nn">viam.proto.app.robot</span> <span class="kn">import</span> <span class="n">ComponentConfig</span>
<span class="kn">from</span> <span class="nn">viam.proto.common</span> <span class="kn">import</span> <span class="n">ResourceName</span>
<span class="kn">from</span> <span class="nn">viam.resource.base</span> <span class="kn">import</span> <span class="n">ResourceBase</span>
<span class="kn">from</span> <span class="nn">viam.resource.registry</span> <span class="kn">import</span> <span class="n">Registry</span><span class="p">,</span> <span class="n">ResourceCreatorRegistration</span>
<span class="kn">from</span> <span class="nn">viam.resource.types</span> <span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">ModelFamily</span>


<span class="k">class</span> <span class="nc">MyModularArm</span><span class="p">(</span><span class="n">Arm</span><span class="p">):</span>
    <span class="c1"># Subclass the Viam Arm component and implement the required functions</span>
    <span class="n">MODEL</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Model</span><span class="p">]</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">ModelFamily</span><span class="p">(</span><span class="s2">&quot;viam&quot;</span><span class="p">,</span> <span class="s2">&quot;arm&quot;</span><span class="p">),</span> <span class="s2">&quot;my-arm&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># Starting joint positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_positions</span> <span class="o">=</span> <span class="n">JointPositions</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>


        <span class="c1"># Minimal working kinematics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kinematics</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;MyArm&quot;</span><span class="p">,</span>
                <span class="s2">&quot;links&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="s2">&quot;world&quot;</span><span class="p">,</span> <span class="s2">&quot;translation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}}],</span>
                <span class="s2">&quot;joints&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;waist&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;revolute&quot;</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">359</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">359</span><span class="p">}</span>
                <span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ComponentConfig</span><span class="p">,</span> <span class="n">dependencies</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">ResourceName</span><span class="p">,</span> <span class="n">ResourceBase</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="n">arm</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">arm</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_end_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pose</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">move_to_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">:</span> <span class="n">Pose</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_joint_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JointPositions</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_positions</span>

    <span class="nd">@run_with_operation</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">move_to_joint_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">:</span> <span class="n">JointPositions</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_operation</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_stopped</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Simulate the length of time it takes for the arm to move to its new joint position</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Check if the operation is cancelled and, if it is, stop the arm&#39;s motion</span>
            <span class="k">if</span> <span class="k">await</span> <span class="n">operation</span><span class="o">.</span><span class="n">is_cancelled</span><span class="p">():</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="k">break</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_positions</span> <span class="o">=</span> <span class="n">positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_stopped</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_stopped</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">is_moving</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stopped</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_kinematics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">KinematicsFileFormat</span><span class="o">.</span><span class="n">ValueType</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">KinematicsFileFormat</span><span class="o">.</span><span class="n">KINEMATICS_FILE_FORMAT_SVA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kinematics</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function creates and starts a new module, after adding all desired resource model.</span>
<span class="sd">    Resource creators must be registered to the resource registry before the module adds the resource model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Registry</span><span class="o">.</span><span class="n">register_resource_creator</span><span class="p">(</span><span class="n">Arm</span><span class="o">.</span><span class="n">SUBTYPE</span><span class="p">,</span> <span class="n">MyModularArm</span><span class="o">.</span><span class="n">MODEL</span><span class="p">,</span> <span class="n">ResourceCreatorRegistration</span><span class="p">(</span><span class="n">MyModularArm</span><span class="o">.</span><span class="n">new</span><span class="p">))</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">Module</span><span class="o">.</span><span class="n">from_args</span><span class="p">()</span>
    <span class="n">module</span><span class="o">.</span><span class="n">add_model_from_registry</span><span class="p">(</span><span class="n">Arm</span><span class="o">.</span><span class="n">SUBTYPE</span><span class="p">,</span> <span class="n">MyModularArm</span><span class="o">.</span><span class="n">MODEL</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">module</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>Lastly, make the module executable and configure the module on your robot.</p>
</section>
</section>
<section id="create-custom-remotes">
<h2>Create custom remotes<a class="headerlink" href="#create-custom-remotes" title="Permalink to this heading"></a></h2>
<p><strong>CAUTION</strong> <em><a class="reference external" href="https://python.viam.dev/examples/example.html#create-custom-modules">Modular resources</a> are the preferred method of creating custom resource implementations for the Python SDK unless you are hosting viam-server on a non-Linux system or have another issue with compilation.</em></p>
<p>While the main RDK is written in golang, you can create custom components in python and connect them to a robot as a <a class="reference external" href="https://docs.viam.com/extend/custom-components-remotes/"><code class="docutils literal notranslate"><span class="pre">remote</span></code> component</a>. This allows you to extend the functionality of a robot, or even create an entire robot exclusively in python.</p>
<p>To create a custom component and connect it to the RDK:</p>
<ol class="arabic simple">
<li><p><strong>Subclass a component and implement desired functions</strong>. This will be your custom component.</p>
<ul class="simple">
<li><p>For functions you do not wish to implement, you must at least define them by putting <code class="docutils literal notranslate"><span class="pre">pass</span></code> or <code class="docutils literal notranslate"><span class="pre">raiseNotImplementedError()</span></code> in the function.</p></li>
</ul>
</li>
<li><p><strong>Create an <code class="docutils literal notranslate"><span class="pre">rpc.server.Server</span></code> instance and register the custom component</strong>. This is the <code class="docutils literal notranslate"><span class="pre">RPC</span></code> server that enables communication with your custom component.</p></li>
<li><p><strong>Start the <code class="docutils literal notranslate"><span class="pre">Server</span></code> and register the running server as a remote</strong>. Registering this <code class="docutils literal notranslate"><span class="pre">RPC</span></code> server as a remote allows the RDK to communicate with the server.</p></li>
</ol>
<section id="subclass-a-component">
<h3>1. Subclass a component<a class="headerlink" href="#subclass-a-component" title="Permalink to this heading"></a></h3>
<p>The SDK provides a wide array of components to customize. You can browse through the API Reference to see all of them, but for now we’ll use an <code class="docutils literal notranslate"><span class="pre">Arm</span></code> as an example. Our custom Arm will be extremely simple – it will only save and return the positions provided to it.</p>
<p>Let’s start by creating a directory called <code class="docutils literal notranslate"><span class="pre">my-python-robot</span></code>. Inside of that directory, create a file called <code class="docutils literal notranslate"><span class="pre">my_cool_arm.py</span></code>. The contents of <code class="docutils literal notranslate"><span class="pre">my_cool_arm.py</span></code> should be as follows:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: #ffffcc }
.highlight { background: #f8f8f8; }
.highlight .c { color: #3D7B7B; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #9C6500 } /* Comment.Preproc */
.highlight .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.highlight .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight .gr { color: #E40000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #008400 } /* Generic.Inserted */
.highlight .go { color: #717171 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #687822 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #717171; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #767600 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sa { color: #BA2121 } /* Literal.String.Affix */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #A45A77 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0000FF } /* Name.Function.Magic */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .vm { color: #19177C } /* Name.Variable.Magic */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */</style><div class="highlight"><pre><span></span><span class="c1"># my-python-robot/my_cool_arm.py</span>

<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">from</span> <span class="nn">viam.components.arm</span> <span class="kn">import</span> <span class="n">Arm</span><span class="p">,</span> <span class="n">JointPositions</span><span class="p">,</span> <span class="n">KinematicsFileFormat</span><span class="p">,</span> <span class="n">Pose</span>
<span class="kn">from</span> <span class="nn">viam.operations</span> <span class="kn">import</span> <span class="n">run_with_operation</span>
<span class="kn">from</span> <span class="nn">viam.proto.common</span> <span class="kn">import</span> <span class="n">Capsule</span><span class="p">,</span> <span class="n">Geometry</span><span class="p">,</span> <span class="n">Sphere</span>


<span class="k">class</span> <span class="nc">MyCoolArm</span><span class="p">(</span><span class="n">Arm</span><span class="p">):</span>
    <span class="c1"># Subclass the Viam Arm component and implement the required functions</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># Starting position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">Pose</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">o_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">o_y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">o_z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">theta</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Starting joint positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_positions</span> <span class="o">=</span> <span class="n">JointPositions</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_stopped</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Geometry</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">Pose</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">o_x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">o_y</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">o_z</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span> <span class="n">sphere</span><span class="o">=</span><span class="n">Sphere</span><span class="p">(</span><span class="n">radius_mm</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
            <span class="n">Geometry</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">Pose</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">o_x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">o_y</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">o_z</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span> <span class="n">capsule</span><span class="o">=</span><span class="n">Capsule</span><span class="p">(</span><span class="n">radius_mm</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">length_mm</span><span class="o">=</span><span class="mi">8</span><span class="p">)),</span>
        <span class="p">]</span>

        <span class="c1"># Minimal working kinematics model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kinematics</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;MyArm&quot;</span><span class="p">,</span>
                <span class="s2">&quot;links&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="s2">&quot;world&quot;</span><span class="p">,</span> <span class="s2">&quot;translation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}}],</span>
                <span class="s2">&quot;joints&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;waist&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;revolute&quot;</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">359</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">359</span><span class="p">}</span>
                <span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_end_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pose</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>

    <span class="nd">@run_with_operation</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">move_to_position</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pose</span><span class="p">:</span> <span class="n">Pose</span><span class="p">,</span>
        <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_operation</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_stopped</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">pose</span>

        <span class="c1"># Simulate the length of time it takes for the arm to move to its new position</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Check if the operation is cancelled and, if it is, stop the arm&#39;s motion</span>
            <span class="k">if</span> <span class="k">await</span> <span class="n">operation</span><span class="o">.</span><span class="n">is_cancelled</span><span class="p">():</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="k">break</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_stopped</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_joint_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JointPositions</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_positions</span>

    <span class="nd">@run_with_operation</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">move_to_joint_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">:</span> <span class="n">JointPositions</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_operation</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_stopped</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_positions</span> <span class="o">=</span> <span class="n">positions</span>

        <span class="c1"># Simulate the length of time it takes for the arm to move to its new joint position</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Check if the operation is cancelled and, if it is, stop the arm&#39;s motion</span>
            <span class="k">if</span> <span class="k">await</span> <span class="n">operation</span><span class="o">.</span><span class="n">is_cancelled</span><span class="p">():</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="k">break</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_stopped</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_stopped</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">is_moving</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stopped</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_geometries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Geometry</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_kinematics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">KinematicsFileFormat</span><span class="o">.</span><span class="n">ValueType</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">KinematicsFileFormat</span><span class="o">.</span><span class="n">KINEMATICS_FILE_FORMAT_SVA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kinematics</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This is a completely optional function to include. This will be called when the resource is removed from the config or the module</span>
        <span class="c1"># is shutting down.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is closed.&quot;</span><span class="p">)</span>
</pre></div>
</div></div>
</div>
<p>You can view more component implementations in the <a class="reference external" href="https://github.com/viamrobotics/python-sdk/blob/main/examples/server/v1/components.py">examples</a>.</p>
<p>This arm example contains a minimal kinematics model. For a full model, take a look <a class="reference external" href="https://github.com/viamrobotics/viam-python-sdk/blob/main/examples/complex_module/src/arm/my_arm_kinematics.json">here</a>.</p>
</section>
<section id="register-the-custom-component">
<h3>2. Register the custom component<a class="headerlink" href="#register-the-custom-component" title="Permalink to this heading"></a></h3>
<p>Now that we’ve created the custom component, we must register it so that it will be visible to any robots connecting to it. This is done by creating an <code class="docutils literal notranslate"><span class="pre">RPC</span></code> server and adding <code class="docutils literal notranslate"><span class="pre">MyCoolArm</span></code> as a connected component. This <code class="docutils literal notranslate"><span class="pre">RPC</span></code> server will receive gRPC requests from the Viam Server or any other connections and forward those requests to your custom component.</p>
<p>In the same <code class="docutils literal notranslate"><span class="pre">my-python-robot</span></code> directory, create a new file called <code class="docutils literal notranslate"><span class="pre">main.py</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># my-python-robot/main.py</span>

<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">viam.rpc.server</span> <span class="kn">import</span> <span class="n">Server</span>

<span class="kn">from</span> <span class="nn">my_cool_arm</span> <span class="kn">import</span> <span class="n">MyCoolArm</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">srv</span> <span class="o">=</span> <span class="n">Server</span><span class="p">([</span><span class="n">MyCoolArm</span><span class="p">(</span><span class="s2">&quot;my-arm&quot;</span><span class="p">)])</span>
    <span class="k">await</span> <span class="n">srv</span><span class="o">.</span><span class="n">serve</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="start-the-server-and-add-it-as-a-remote">
<h3>3. Start the Server and add it as a Remote<a class="headerlink" href="#start-the-server-and-add-it-as-a-remote" title="Permalink to this heading"></a></h3>
<p>Now that we have a server that knows about our custom Arm component, we need to start the server so it can receive gRPC calls. Once it’s started, we can then register this server as a remote.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># my-python-robot/main.py</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
  <span class="o">...</span>
  <span class="k">await</span> <span class="n">srv</span><span class="o">.</span><span class="n">serve</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>NB</strong>: When you call <code class="docutils literal notranslate"><span class="pre">srv.serve()</span></code>, the default host and port is <code class="docutils literal notranslate"><span class="pre">localhost:9090</span></code>. This can be changed by passing in a <code class="docutils literal notranslate"><span class="pre">host</span></code> and/or <code class="docutils literal notranslate"><span class="pre">port</span></code> parameter to the <code class="docutils literal notranslate"><span class="pre">serve</span></code> function.</p>
<p>To use this custom server as part of a larger robot, you’ll want to add it as a <code class="docutils literal notranslate"><span class="pre">remote</span></code> in the config for your main part.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-cool-python-components&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// The name of the remote, can be anything</span>
<span class="w">      </span><span class="nt">&quot;insecure&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">                    </span><span class="c1">// Whether this connection should use SSL</span>
<span class="w">      </span><span class="nt">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;localhost:9090&quot;</span><span class="w">          </span><span class="c1">// The location of the remote robot</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
</pre></div>
</div>
<p>And to ensure that the python server starts up with the rest of the robot, you can add it as a process.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-python-server-process&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;log&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;/home/pi/my-python-robot/main.py&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>NB</strong>: The <code class="docutils literal notranslate"><span class="pre">viam-server</span></code> starts as a root process, so you may need to switch users to run the python SDK server.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;log&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sudo&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;-u&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;pi&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;/home/pi/my-python-robot/main.py&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="convert-a-custom-remote-to-a-custom-module">
<h2>Convert a custom remote to a custom module<a class="headerlink" href="#convert-a-custom-remote-to-a-custom-module" title="Permalink to this heading"></a></h2>
<p>Modular resources are the preferred method of creating custom resource implementations for the Python SDK unless you are hosting viam-server on a non-Linux system or have another issue with compilation. Already existing custom remote resources can be converted to custom module resources.</p>
<p>This section will go over the steps it takes to convert a custom remote to a custom module.
<code class="docutils literal notranslate"><span class="pre">MySensor</span></code> is currently a custom remote component, written here:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">viam.components.sensor</span> <span class="kn">import</span> <span class="n">Geometry</span><span class="p">,</span> <span class="n">Sensor</span>
<span class="kn">from</span> <span class="nn">viam.rpc.server</span> <span class="kn">import</span> <span class="n">Server</span>
<span class="kn">from</span> <span class="nn">viam.utils</span> <span class="kn">import</span> <span class="n">SensorReading</span>


<span class="k">class</span> <span class="nc">MySensor</span><span class="p">(</span><span class="n">Sensor</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_readings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SensorReading</span><span class="p">]:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/proc/net/wireless&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">wifi_stats</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">wifi_stats</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">wifi_signal</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">content</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="n">wifi_signal</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">wifi_signal</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;noise&quot;</span><span class="p">:</span> <span class="n">wifi_signal</span><span class="p">[</span><span class="mi">4</span><span class="p">]}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_geometries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Geometry</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">srv</span> <span class="o">=</span> <span class="n">Server</span><span class="p">([</span><span class="n">MySensor</span><span class="p">(</span><span class="s2">&quot;my-sensor&quot;</span><span class="p">)])</span>
    <span class="k">await</span> <span class="n">srv</span><span class="o">.</span><span class="n">serve</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>The two steps that are required to convert a custom remote resource to a custom module resource are as follows:</p>
<ol class="arabic simple">
<li><p><strong>Register the resource.</strong> This will register a new modular resource model into the Registry.</p></li>
<li><p><strong>Make the module executable.</strong> This allows viam-server to access and execute the module.</p></li>
</ol>
<p>Add a <a class="reference external" href="https://docs.viam.com/extend/modular-resources/#models"><code class="docutils literal notranslate"><span class="pre">Model</span></code></a> name and a creator function in the resource by defining a new <code class="docutils literal notranslate"><span class="pre">MODEL</span></code> variable in the class. Then add a function that will act as the creator function. For more details on how to add these two, follow the pertaining steps in <a class="reference external" href="https://python.viam.dev/examples/example.html#register-the-new-modular-resource">Register the new modular resource</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ADD THE NECESSARY IMPORTS TO DEFINE A MODEL NAME AND CREATOR FUNCTION.</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">ClassVar</span><span class="p">,</span> <span class="n">Mapping</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Self</span>

<span class="kn">from</span> <span class="nn">viam.proto.app.robot</span> <span class="kn">import</span> <span class="n">ComponentConfig</span>
<span class="kn">from</span> <span class="nn">viam.proto.common</span> <span class="kn">import</span> <span class="n">ResourceName</span>
<span class="kn">from</span> <span class="nn">viam.resource.base</span> <span class="kn">import</span> <span class="n">ResourceBase</span>
<span class="kn">from</span> <span class="nn">viam.resource.types</span> <span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">ModelFamily</span>

<span class="k">class</span> <span class="nc">MySensor</span><span class="p">(</span><span class="n">Sensor</span><span class="p">):</span>
    <span class="c1"># ADD A MODEL NAME IN THE EXISTING RESOURCE CLASS.</span>
    <span class="n">MODEL</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Model</span><span class="p">]</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">ModelFamily</span><span class="p">(</span><span class="s2">&quot;viam-labs&quot;</span><span class="p">,</span><span class="s2">&quot;sensor&quot;</span><span class="p">),</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span>

    <span class="c1"># ADD A CREATOR FUNCTION IN THE EXISTING RESOURCE CLASS.</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ComponentConfig</span><span class="p">,</span> <span class="n">dependencies</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">ResourceName</span><span class="p">,</span> <span class="n">ResourceBase</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resource</span>
</pre></div>
</div>
<p>In the resource’s main function or <code class="docutils literal notranslate"><span class="pre">main.py</span></code> file, replace the content of <code class="docutils literal notranslate"><span class="pre">main()</span></code> with the content below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ADD THE NECESSARY IMPORTS TO REGISTER THE NEW MODEL</span>
<span class="kn">from</span> <span class="nn">viam.module.module</span> <span class="kn">import</span> <span class="n">Module</span>
<span class="kn">from</span> <span class="nn">viam.resource.registry</span> <span class="kn">import</span> <span class="n">Registry</span><span class="p">,</span> <span class="n">ResourceCreatorRegistration</span>

<span class="c1"># REPLACE THE MAIN FUNCTION/FILE SO THAT IT CALLS `register_resource_creator()` AND STARTS THE MODULE.</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">Registry</span><span class="o">.</span><span class="n">register_resource_creator</span><span class="p">(</span><span class="n">Sensor</span><span class="o">.</span><span class="n">SUBTYPE</span><span class="p">,</span> <span class="n">MySensor</span><span class="o">.</span><span class="n">MODEL</span><span class="p">,</span> <span class="n">ResourceCreatorRegistration</span><span class="p">(</span><span class="n">MySensor</span><span class="o">.</span><span class="n">new</span><span class="p">))</span>

    <span class="n">module</span> <span class="o">=</span> <span class="n">Module</span><span class="o">.</span><span class="n">from_args</span><span class="p">()</span>
    <span class="n">module</span><span class="o">.</span><span class="n">add_model_from_registry</span><span class="p">(</span><span class="n">Sensor</span><span class="o">.</span><span class="n">SUBTYPE</span><span class="p">,</span> <span class="n">MySensor</span><span class="o">.</span><span class="n">MODEL</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">module</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>Follow the steps outlined in the section <a class="reference external" href="https://python.viam.dev/examples/example.html#make-the-module-executable">Make the module executable</a> in the directory of the component.</p>
<p>The custom remote component is now a custom module component. To use the component in the web UI, follow the steps to <a class="reference external" href="https://python.viam.dev/examples/example.html#configure-a-modular-resource">configure the new modular resource</a>.</p>
<p>For easy visualization, the differences in the configuration JSONs and code are below.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Custom remote</p></th>
<th class="head text-left"><p>Custom module</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><pre>{<br>    “remotes”: [<br>      {<br>        “name”: “my-sensor”,<br>        “insecure”: true,<br>        “address”: “localhost:9090”<br>      }<br>    ],<br>    “processes”: [<br>      {<br>        “id”: “my-python-server-process”,<br>        “log”: true,<br>        “name”: “python”,<br>        “args”: [<br>          “/home/my_sensor/my_sensor.py”<br>        ]<br>      }<br>    ]<br>  } </pre></p></td>
<td class="text-left"><p><pre>{<br>  “components”: [<br>    {<br>      “depends_on”: [],<br>      “model”: “viam-labs:sensor:test”,<br>      “name”: “my-sensor”,<br>      “type”: “sensor”,<br>      “attributes”: {}<br>    }<br>  ],<br>  “modules”: [<br>    {<br>      “executable_path”: “/home/my_sensor/run.sh”,<br>      “name”: “testsensor”,<br>      “type”: “local”<br>    }<br>  ]<br>} </pre></p></td>
</tr>
</tbody>
</table>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Image</span>

<span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;./codediff.png&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/3217c6da0cbe6fc51d6f40e845b3f2c3ab886988041ea6513264ba959f9e7465.png" src="../_images/3217c6da0cbe6fc51d6f40e845b3f2c3ab886988041ea6513264ba959f9e7465.png" />
</div>
</div>
</section>
<section id="operations">
<h2>Operations<a class="headerlink" href="#operations" title="Permalink to this heading"></a></h2>
<p>Operations are used by the RDK to keep track of running tasks, and provide a means to query their status and even cancel them. In order for a component to respond appropriately to any Operation requests, we must obtain and listen to the Operation in our method calls.</p>
<p>In order to take advantage of operations, you should wrap the component method with the <code class="docutils literal notranslate"><span class="pre">run_with_operation</span></code> decorator from the <code class="docutils literal notranslate"><span class="pre">viam.operations</span></code> package. Each component has a function, <code class="docutils literal notranslate"><span class="pre">get_operation(kwargs:</span> <span class="pre">Mapping[str,</span> <span class="pre">Any])</span> <span class="pre">-&gt;</span> <span class="pre">Operation</span></code>, that will return an Operation that will tell us if the operation is ever cancelled, allowing us to clean up any long running tasks, close connections, etc.</p>
<p>It is extremely important that we check the <code class="docutils literal notranslate"><span class="pre">Operation</span></code> status, as this not only prevents any unnecessary resource usage, but also allows us to respond to urgent cancellation requests and stop components’ motion.</p>
</section>
<section id="connect-as-a-client-to-app">
<h2>Connect as a client to app<a class="headerlink" href="#connect-as-a-client-to-app" title="Permalink to this heading"></a></h2>
<p>To connect to app as a client and make calls to the data API, you should create an instance of a <code class="docutils literal notranslate"><span class="pre">ViamClient</span></code> and retrieve its <code class="docutils literal notranslate"><span class="pre">DataClient</span></code> member.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">viam.rpc.dial</span> <span class="kn">import</span> <span class="n">DialOptions</span><span class="p">,</span> <span class="n">Credentials</span>
<span class="kn">from</span> <span class="nn">viam.app.viam_client</span> <span class="kn">import</span> <span class="n">ViamClient</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">connect</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ViamClient</span><span class="p">:</span>
    <span class="n">dial_options</span> <span class="o">=</span> <span class="n">DialOptions</span><span class="o">.</span><span class="n">with_api_key</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;&lt;API_KEY&gt;&quot;</span><span class="p">,</span> <span class="n">api_key_id</span><span class="o">=</span><span class="s2">&quot;&lt;API_KEY_ID&gt;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">ViamClient</span><span class="o">.</span><span class="n">create_from_dial_options</span><span class="p">(</span><span class="n">dial_options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Once you have a connected <code class="docutils literal notranslate"><span class="pre">ViamClient</span></code>, you can then obtain a <code class="docutils literal notranslate"><span class="pre">DataClient</span></code> as a property.</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_client</span> <span class="o">=</span> <span class="n">viam_client</span><span class="o">.</span><span class="n">data_client</span>
</pre></div>
</div>
</div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">DataClient</span></code> can be used to make method calls that retrieve data from app.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">viam.utils</span> <span class="kn">import</span> <span class="n">create_filter</span>

<span class="n">left_motor_filter</span> <span class="o">=</span> <span class="n">create_filter</span><span class="p">(</span>
    <span class="n">component_name</span><span class="o">=</span><span class="s2">&quot;left_motor&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="n">end_time</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;speed_test_run&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">data_client</span><span class="o">.</span><span class="n">tabular_data_by_filter</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="n">left_motor_filter</span><span class="p">)</span>
<span class="k">for</span> <span class="n">tab</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[DataClient.TabularData(data={&#39;IsPowered&#39;: False, &#39;PowerPct&#39;: 0.0}, metadata=method_name: &quot;IsPowered&quot;
, time_requested=datetime.datetime(2022, 1, 1, 1, 1, 1), time_received=datetime.datetime(2022, 12, 31, 23, 59, 59)), DataClient.TabularData(data={&#39;IsPowered&#39;: False, &#39;PowerPct&#39;: 0.0}, metadata=location_id: &quot;loc-id&quot;
, time_requested=datetime.datetime(2023, 1, 2, 0, 0), time_received=datetime.datetime(2023, 3, 4, 0, 0)), DataClient.TabularData(data={&#39;Position&#39;: 0.0}, metadata=, time_requested=datetime.datetime(2023, 5, 6, 0, 0), time_received=datetime.datetime(2023, 7, 8, 0, 0))]
0
</pre></div>
</div>
</div>
</div>
<p>You can also use your <code class="docutils literal notranslate"><span class="pre">DataClient</span></code> to upload data to app.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_requested_1</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<span class="n">time_received_1</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="k">await</span> <span class="n">data_client</span><span class="o">.</span><span class="n">tabular_data_capture_upload</span><span class="p">(</span>
    <span class="n">part_id</span><span class="o">=</span><span class="s2">&quot;&lt;ID&gt;&quot;</span><span class="p">,</span>  <span class="c1"># Unique ID of the relevant robot part.</span>
    <span class="n">component_type</span><span class="o">=</span><span class="s2">&quot;rdk:component:motor&quot;</span><span class="p">,</span>
    <span class="n">component_name</span><span class="o">=</span><span class="s2">&quot;left_motor&quot;</span><span class="p">,</span>
    <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;IsPowered&quot;</span><span class="p">,</span>
    <span class="n">method_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tag_1&quot;</span><span class="p">,</span> <span class="s2">&quot;tag_2&quot;</span><span class="p">],</span>
    <span class="n">data_request_times</span><span class="o">=</span><span class="p">[(</span><span class="n">time_requested_1</span><span class="p">,</span> <span class="n">time_received_1</span><span class="p">)],</span>
    <span class="n">tabular_data</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;PowerPCT&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;IsPowered&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&#39;
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ViamClient</span></code> objects also house an <code class="docutils literal notranslate"><span class="pre">AppClient</span></code>, which can be used to retrieve information about your organization in App or make certain changes to it. The <code class="docutils literal notranslate"><span class="pre">AppClient</span></code> can be obtained in a manner similar to the <code class="docutils literal notranslate"><span class="pre">DataClient</span></code>.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">app_client</span> <span class="o">=</span> <span class="n">viam_client</span><span class="o">.</span><span class="n">app_client</span>
</pre></div>
</div>
</div>
</div>
<p>With this <code class="docutils literal notranslate"><span class="pre">AppClient</span></code>, you can access information about entities within your organization. For example, you can list information about all robots under your organization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_organizations</span> <span class="o">=</span> <span class="k">await</span> <span class="n">app_client</span><span class="o">.</span><span class="n">list_organizations</span><span class="p">()</span>
<span class="n">MY_ORG_ID</span> <span class="o">=</span> <span class="n">my_organizations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
<span class="n">my_locations</span> <span class="o">=</span> <span class="k">await</span> <span class="n">app_client</span><span class="o">.</span><span class="n">list_locations</span><span class="p">(</span><span class="n">org_id</span><span class="o">=</span><span class="n">MY_ORG_ID</span><span class="p">)</span>
<span class="n">robots</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">my_locations</span><span class="p">:</span>
    <span class="n">more_robots</span> <span class="o">=</span> <span class="k">await</span> <span class="n">app_client</span><span class="o">.</span><span class="n">list_robots</span><span class="p">(</span><span class="n">location_id</span><span class="o">=</span><span class="n">location</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="n">robots</span> <span class="o">+=</span> <span class="n">more_robots</span>

<span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="n">robots</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>robot-0
robot-1
robot-2
robot-3
</pre></div>
</div>
</div>
</div>
<p>You can also create new robots/robot parts or make updates to robots/robot parts that already already exist, or even delete them!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a new robot named &quot;new_rover&quot;.</span>
<span class="n">NEW_ROBOT_ID</span> <span class="o">=</span> <span class="k">await</span> <span class="n">app_client</span><span class="o">.</span><span class="n">new_robot</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;new_rover&quot;</span><span class="p">,</span> <span class="n">location_id</span><span class="o">=</span><span class="n">my_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

<span class="c1"># Change the new robot&#39;s name to &quot;rover&quot; and assign it a new parent location.</span>
<span class="n">updated_robot</span> <span class="o">=</span> <span class="k">await</span> <span class="n">app_client</span><span class="o">.</span><span class="n">update_robot</span><span class="p">(</span><span class="n">robot_id</span><span class="o">=</span><span class="n">NEW_ROBOT_ID</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rover&quot;</span><span class="p">,</span> <span class="n">location_id</span><span class="o">=</span><span class="s2">&quot;&lt;LOCATION_ID&quot;</span><span class="p">)</span>

<span class="c1"># Delete the new robot.</span>
<span class="k">await</span> <span class="n">app_client</span><span class="o">.</span><span class="n">delete_robot</span><span class="p">(</span><span class="n">robot_id</span><span class="o">=</span><span class="n">NEW_ROBOT_ID</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Certain types returned by <code class="docutils literal notranslate"><span class="pre">AppClient</span></code> methods (namely, <code class="docutils literal notranslate"><span class="pre">RobotPart</span></code>, <code class="docutils literal notranslate"><span class="pre">LogEntry</span></code>, <code class="docutils literal notranslate"><span class="pre">Fragment</span></code>, and <code class="docutils literal notranslate"><span class="pre">RobotPartHistoryEntry</span></code> objects) are wrapped in mirror classes that convert proto data into a friendlier, more readable format. Each of these mirrors still allows access to the initial proto type returned by the response as a property.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">logs</span> <span class="o">=</span> <span class="k">await</span> <span class="n">app_client</span><span class="o">.</span><span class="n">get_robot_part_logs</span><span class="p">(</span><span class="n">robot_part_id</span><span class="o">=</span><span class="s2">&quot;&lt;ID&gt;&quot;</span><span class="p">,</span> <span class="n">num_log_entries</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">logs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">caller</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*****PROTO*****</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">logs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">proto</span><span class="o">.</span><span class="n">caller</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Function: go.viam.com/rdk/robot/impl.(*resourceManager).updateResources
Line: 922.0
Defined: True
File: /__w/rdk/rdk/robot/impl/resource_manager.go

*****PROTO*****

fields {
  key: &quot;Line&quot;
  value {
    number_value: 922
  }
}
fields {
  key: &quot;Function&quot;
  value {
    string_value: &quot;go.viam.com/rdk/robot/impl.(*resourceManager).updateResources&quot;
  }
}
fields {
  key: &quot;File&quot;
  value {
    string_value: &quot;/__w/rdk/rdk/robot/impl/resource_manager.go&quot;
  }
}
fields {
  key: &quot;Defined&quot;
  value {
    bool_value: true
  }
}
</pre></div>
</div>
</div>
</div>
<p>At the end, you may close the connection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">viam_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="Viam Python SDK" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../changelog.html" class="btn btn-neutral float-right" title="&lt;no title&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2024, Viam Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>